# QR-EMS (QR-code Equipment Management System)

**QR-EMS** æ˜¯ä¸€å¥—ç¾ä»£åŒ–çš„è¨­å‚™è³‡ç”¢ç®¡ç†è§£æ±ºæ–¹æ¡ˆï¼Œå°ˆç‚ºè§£æ±ºå¯¦é©—å®¤ã€è¾¦å…¬å®¤æˆ–å…±äº«ç©ºé–“ä¸­è¨­å‚™è¿½è¹¤ä¸æ˜“ã€å€Ÿé‚„æµç¨‹ç¹ç‘£çš„å•é¡Œè€Œè¨­è¨ˆã€‚

é€éæ•´åˆ **QR Code å¿«é€Ÿæƒæ**æŠ€è¡“ï¼Œä½¿ç”¨è€…åƒ…éœ€ä½¿ç”¨æ‰‹æ©Ÿæˆ– WebCam æƒæè¨­å‚™ä¸Šçš„æ¨™ç±¤ï¼Œå³å¯å¿«é€Ÿæª¢è¦–è¨­å‚™è©³æƒ…ã€ç‹€æ…‹æˆ–é€²è¡Œå€Ÿé‚„æ“ä½œã€‚ç³»çµ±å…§å»ºå®Œæ•´çš„**æ¬Šé™ç®¡ç†**ï¼ˆAdmin/Manager/Userï¼‰èˆ‡**ç°½æ ¸æµç¨‹**ï¼Œä¸¦æ¡ç”¨ **Docker** å…¨å®¹å™¨åŒ–éƒ¨ç½²èˆ‡ **Cloudflare Tunnel** å®‰å…¨ç©¿é€æŠ€è¡“ï¼Œè®“ç®¡ç†è€…ç„¡éœ€ç¹é›œçš„ç¶²è·¯è¨­å®šï¼Œå³å¯è¼•é¬†åœ¨ä»»ä½•åœ°é»æŒæ¡è³‡ç”¢å‹•æ…‹ã€‚

---

## ğŸš€ æ ¸å¿ƒåŠŸèƒ½ (Key Features)

### ğŸ“¦ æ™ºæ…§è³‡ç”¢èˆ‡å€‰å„²ç®¡ç†
*   **å¤šå±¤ç´šä½ç½®ç®¡ç†**ï¼šæ”¯æ´å»ºç«‹ã€Œå€ > æ«ƒ > ä½ã€ç­‰å¤šå±¤ç´šå€‰åº«çµæ§‹ï¼Œç²¾ç¢ºè¿½è¹¤è¨­å‚™å­˜æ”¾é»ã€‚
*   **å…¨æ–¹ä½ç‹€æ…‹è¿½è¹¤**ï¼šå³æ™‚æŒæ¡è¨­å‚™ç‹€æ…‹ï¼ˆå¯å€Ÿç”¨ã€å·²å€Ÿå‡ºã€ç¶­è­·ä¸­ã€éœ€ç§»å‹•ã€ç§»å‹•ä¸­ã€éºå¤±ã€å·²å ±å»¢ï¼‰ã€‚
*   **æ™ºèƒ½ç§»å‹•æµç¨‹**ï¼šæ”¯æ´é è¨­è¨­å‚™ç›®çš„åœ°ï¼ˆTarget Locationï¼‰ï¼Œé€éæƒæç›®çš„åœ° QR Code è‡ªå‹•æ¯”å°è¨­å‚™ï¼Œæ¸›å°‘æ”¾éŒ¯ä½ç½®çš„æ©Ÿç‡ã€‚
*   **è©³ç´°è³‡ç”¢å±¥æ­·**ï¼šå®Œæ•´è¨˜éŒ„æ¯ä¸€æ¬¡çš„å€Ÿç”¨ã€æ­¸é‚„ã€ç¶­è­·èˆ‡è³‡æ–™è®Šæ›´ï¼Œæ–¹ä¾¿è³‡ç”¢ç›¤é»èˆ‡è¿½æº¯ã€‚
*   **å¤šå…ƒè¨­å‚™åˆ†é¡**ï¼šæ”¯æ´ç­†é›»ã€é¡¯ç¤ºå™¨ã€é–‹ç™¼æ¿ã€ç·šæã€å®¶å…·ç­‰å¤šç¨®è‡ªè¨‚é¡åˆ¥ã€‚
*   **éˆæ´»ç¯©é¸èˆ‡æœå°‹**ï¼šæä¾›å„€è¡¨æ¿å³æ™‚ç¯©é¸èˆ‡åˆ†é åŠŸèƒ½ï¼Œå¿«é€Ÿæ‰¾åˆ°ç›®æ¨™è¨­å‚™ã€‚

### ğŸ“± QR Code æƒææ•´åˆ
*   **ä¸€éµæƒæ**ï¼šæ”¯æ´è¡Œå‹•è£ç½®ç›¸æ©Ÿæˆ–é›»è…¦ WebCam æƒæï¼Œæ”¯æ´è¨­å‚™ QR Code (è·³è½‰è©³æƒ…) èˆ‡ä½ç½® QR Code (å•Ÿå‹•å…¥åº«ç¨‹åº)ã€‚
*   **å³æ™‚ç”Ÿæˆ**ï¼šæ¯é …è¨­å‚™èˆ‡å­˜æ”¾ä½ç½®çš†è‡ªå‹•ç”Ÿæˆå°ˆå±¬ QR Codeï¼Œå¯ç›´æ¥åˆ—å°æ¨™ç±¤è²¼æ–¼è²¨æ¶æˆ–è¨­å‚™ä¸Šã€‚

### ğŸ›¡ï¸ å®‰å…¨èˆ‡æ¬Šé™
*   **OAuth èº«åˆ†é©—è­‰**ï¼šæ•´åˆ **Google ç™»å…¥**ï¼Œæ”¯æ´ JWT é©—è­‰ï¼Œäº¦æä¾›å‚³çµ±å¸³è™Ÿå¯†ç¢¼è¨»å†ŠåŠŸèƒ½ã€‚
*   **è§’è‰²æ¬Šé™åˆ†ç´š**ï¼š
    *   **Admin (ç®¡ç†å“¡)**ï¼šç³»çµ±å…¨æ¬Šç®¡ç†ã€è§’è‰²åˆ†é…ã€å€‰åº«ä½ç½®è¦åŠƒã€‚
    *   **Manager (ç¶“ç†)**ï¼šè¨­å‚™ç®¡ç†ã€å¯©æ ¸æ­¸é‚„ç”³è«‹ã€ä½ç½®åº«å­˜ç®¡ç†ã€‚
    *   **User (ä½¿ç”¨è€…)**ï¼šç€è¦½è¨­å‚™ã€å€Ÿç”¨ç”³è«‹ã€æƒæå…¥åº«ã€‚
*   **æ­¸é‚„å¯©æ ¸æ©Ÿåˆ¶**ï¼šé˜²æ­¢èª¤æ“ä½œï¼Œæ­¸é‚„éœ€ç¶“ç”±ç®¡ç†äººå“¡å¯©æ ¸å¾Œæ‰ç®—å®Œæˆã€‚

### ğŸ—ï¸ ç¾ä»£åŒ–æŠ€è¡“æ¶æ§‹
*   **Backend:** Python 3.12, Django 6, Django REST Framework (DRF), PostgreSQL.
    *   **Service Layer Pattern:** æ¡ç”¨ Service Layer æ¶æ§‹ (å¦‚ `apps/equipment/services.py`) å°‡è¤‡é›œçš„æ¥­å‹™é‚è¼¯èˆ‡ Transaction ç®¡ç†å¾ ViewSet æŠ½é›¢ï¼Œç¢ºä¿è³‡æ–™ä¸€è‡´æ€§ä¸¦æé«˜å¯æ¸¬è©¦æ€§ã€‚
*   **Frontend:** React 19, TypeScript, Vite, Tailwind CSS.
*   **DevOps:** Docker Compose å…¨ç«¯å®¹å™¨åŒ–, Cloudflare Tunnel (Zero Trust) å…¬ç¶²ç©¿é€.

---

## ğŸ› ï¸ å®‰è£èˆ‡å•Ÿå‹• (Setup & Run)

### 1. ç’°å¢ƒæº–å‚™
ç¢ºä¿æ‚¨çš„ç³»çµ±å·²å®‰è£ä»¥ä¸‹å·¥å…·ï¼š
*   **Docker** & **Docker Compose (V2)** (æŒ‡ä»¤ç‚º `docker compose`ï¼Œé `docker-compose`)
*   **Make** (å¯é¸ï¼Œç”¨æ–¼ç°¡åŒ–æŒ‡ä»¤)
*   **Node.js** >= 20 (è‹¥éœ€æœ¬åœ°é–‹ç™¼å‰ç«¯)
*   **pnpm** >= 10 (è‹¥éœ€æœ¬åœ°é–‹ç™¼å‰ç«¯)

### 2. è¨­å®šç’°å¢ƒè®Šæ•¸
è«‹è¤‡è£½ç¯„ä¾‹è¨­å®šæª”ä¸¦å¡«å…¥æ‚¨çš„åƒæ•¸ï¼š

```bash
# 1. æ ¹ç›®éŒ„ (Docker & Cloudflare è¨­å®š)
cp .env.example .env
# æç¤º: è‹¥ä½¿ç”¨ Cloudflare Dashboard ç®¡ç† Tunnelï¼Œè«‹å¡«å…¥ TUNNEL_TOKEN

# 2. å¾Œç«¯è¨­å®š (Django & DB)
cp backend/.env.example backend/.env
# é‡è¦: ä¿®æ”¹ FRONTEND_URL ç‚ºæ‚¨çš„å…¬é–‹ç¶²å€ (ä¾‹å¦‚ https://qrems.example.com)

# 3. å‰ç«¯è¨­å®š (React & Vite)
cp frontend/.env.example frontend/.env
# é‡è¦: å¡«å…¥ VITE_GOOGLE_CLIENT_ID (éœ€å¾ Google Cloud Console ç”³è«‹)
```

### 3. å•Ÿå‹•æœå‹™
ä½¿ç”¨ `make` æŒ‡ä»¤ä¸€éµå•Ÿå‹•æ‰€æœ‰æœå‹™ï¼š

```bash
make build  # å»ºç½® Docker Images
make up     # å•Ÿå‹•æ‰€æœ‰æœå‹™ (Backend, Frontend, DB, Tunnel)
```

æœå‹™å•Ÿå‹•å¾Œï¼Œæ‚¨å¯é€éä»¥ä¸‹ç¶²å€è¨ªå•ï¼š
*   **Frontend (ä½¿ç”¨è€…ä»‹é¢):** `http://localhost:5173` (æˆ–æ‚¨çš„ Cloudflare å…¬ç¶²ç¶²å€)
*   **Backend API:** `http://localhost:8000/api/v1/`
*   **Admin Panel:** `http://localhost:8000/admin/`

### 4. å»ºç«‹ç®¡ç†å“¡ (Superuser)
åœ¨å®¹å™¨é‹è¡Œç‹€æ…‹ä¸‹ï¼ŒåŸ·è¡Œä»¥ä¸‹æŒ‡ä»¤å»ºç«‹æœ€é«˜æ¬Šé™å¸³è™Ÿï¼š

```bash
make superuser
# æˆ–ç›´æ¥ä½¿ç”¨ Docker
docker compose exec backend uv run python manage.py createsuperuser
```

---

## ğŸ§ª æ¸¬è©¦ (Testing)

æœ¬å°ˆæ¡ˆå»ºè­°åœ¨ Docker å®¹å™¨ç’°å¢ƒä¸­åŸ·è¡Œæ¸¬è©¦ï¼Œä»¥ç¢ºä¿ç’°å¢ƒä¸€è‡´æ€§ä¸¦é¿å…æœ¬åœ°ä¾è³´å•é¡Œã€‚

### åŸ·è¡Œå¾Œç«¯æ¸¬è©¦
ç¢ºä¿æœå‹™å·²å•Ÿå‹• (`make up`)ï¼Œç„¶å¾ŒåŸ·è¡Œï¼š

```bash
# åŸ·è¡Œæ‰€æœ‰å¾Œç«¯æ¸¬è©¦
docker compose exec backend uv run python manage.py test

# åŸ·è¡Œç‰¹å®š App çš„æ¸¬è©¦ (ä¾‹å¦‚ equipment)
docker compose exec backend uv run python manage.py test apps.equipment
```

> **æ³¨æ„**: è‹¥ä½¿ç”¨ `make test` æŒ‡ä»¤ï¼Œè«‹ç¢ºä¿æœ¬åœ°å·²æ­£ç¢ºå®‰è£ Python èˆ‡ `uv` ç’°å¢ƒï¼Œå¦å‰‡å¯èƒ½æœƒå› æ¬Šé™æˆ–è·¯å¾‘å•é¡Œå¤±æ•—ã€‚æ¨è–¦å„ªå…ˆä½¿ç”¨ Docker æŒ‡ä»¤ã€‚

---

## ğŸ”§ ç–‘é›£æ’è§£ (Troubleshooting)

### GitHub Actions CI å¤±æ•—: `docker-compose: command not found`
é€™æ˜¯å› ç‚º CI Runner å·²æ£„ç”¨ Docker Compose V1 æŒ‡ä»¤ã€‚è«‹ç¢ºä¿æ‚¨çš„ Workflow æª”æ¡ˆæˆ–æœ¬åœ°è…³æœ¬ä½¿ç”¨ V2 æŒ‡ä»¤ `docker compose` (ä¸­é–“ç„¡é€£å­—ç¬¦)ï¼Œæœ¬å°ˆæ¡ˆçš„ `Makefile` èˆ‡ `.github/workflows/ci.yml` çš†å·²æ›´æ–°ç‚º V2 èªæ³•ã€‚

### å‰ç«¯ä¾è³´éŒ¯èª¤: Lockfile version mismatch
æœ¬å°ˆæ¡ˆä½¿ç”¨ **pnpm v10**ã€‚è‹¥æ‚¨çš„ CI æˆ–æœ¬åœ°ç’°å¢ƒä½¿ç”¨èˆŠç‰ˆ pnpm (å¦‚ v9)ï¼Œå¯èƒ½æœƒå°è‡´ lockfile è§£æéŒ¯èª¤ã€‚è«‹ç¢ºä¿ç’°å¢ƒä¸­å®‰è£äº†æ­£ç¢ºç‰ˆæœ¬çš„ pnpmï¼š
```bash
npm install -g pnpm@latest
```

### Backend åˆ†é è­¦å‘Š: `UnorderedObjectListWarning`
è‹¥åœ¨æ¸¬è©¦æˆ–é‹è¡Œæ™‚çœ‹åˆ°æ­¤è­¦å‘Šï¼Œè¡¨ç¤º ViewSet çš„ QuerySet ç¼ºå°‘ `.order_by()`ã€‚è«‹æª¢æŸ¥ç›¸é—œ ViewSet (å¦‚ `CategoryViewSet`) æ˜¯å¦å·²æ˜ç¢ºæŒ‡å®šæ’åºæ¬„ä½ã€‚

---

## ğŸ“‚ å°ˆæ¡ˆçµæ§‹æ¦‚è¦½

```text
/
â”œâ”€â”€ backend/            # Django Backend
â”‚   â”œâ”€â”€ apps/           # æ¥­å‹™é‚è¼¯æ¨¡çµ„
â”‚   â”‚   â”œâ”€â”€ equipment/  # è¨­å‚™ç®¡ç†æ ¸å¿ƒ
â”‚   â”‚   â”œâ”€â”€ transactions/ # å€Ÿé‚„èˆ‡äº¤æ˜“ç´€éŒ„
â”‚   â”‚   â”œâ”€â”€ users/      # ä½¿ç”¨è€…èˆ‡é©—è­‰
â”‚   â”‚   â””â”€â”€ locations/  # å€‰åº«èˆ‡ä½ç½®ç®¡ç† (New!)
â”‚   â””â”€â”€ Dockerfile
â”œâ”€â”€ frontend/           # React Frontend
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ api/        # API ä¸²æ¥å±¤
â”‚   â”‚   â”œâ”€â”€ pages/      # ä¸»è¦é é¢
â”‚   â”‚   â”‚   â”œâ”€â”€ Admin/  # ç®¡ç†ç«¯ (è¨­å‚™ã€äººå“¡ã€ä½ç½®ã€å¯©æ ¸)
â”‚   â”‚   â”‚   â”œâ”€â”€ Scan/   # QR Code æƒæèˆ‡å…¥åº«ç¢ºèª
â”‚   â”‚   â”‚   â””â”€â”€ ...
â”‚   â”‚   â””â”€â”€ types/      # TypeScript å‹åˆ¥å®šç¾©
â”‚   â””â”€â”€ Dockerfile
â”œâ”€â”€ docker-compose.yml  # å®¹å™¨ç·¨æ’è¨­å®š
â”œâ”€â”€ Makefile            # å¸¸ç”¨æŒ‡ä»¤é›†
â””â”€â”€ tunnel_config.yml   # Cloudflare Tunnel è¨­å®šç¯„æœ¬
```

## ğŸ“„ æˆæ¬Š (License)
MIT License
