# QR-EMS 頁面詳細邏輯圖解

本文件使用 Mermaid 流程圖詳述各核心頁面的內部執行邏輯。

---

## 1. 首頁 (Dashboard) 邏輯
**核心功能：** 數據過濾、導航分流。

```mermaid
flowchart TD
    A[頁面掛載] --> B[並行請求: 設備清單/類別/位置]
    B --> C{使用者操作?}
    
    C -- "輸入搜尋/變更篩選" --> D[重設分頁為 1]
    D --> E[重新觸發 API 請求]
    E --> B
    
    C -- "點擊快速操作卡片" --> F[帶入 ?intent 參數]
    F --> G[跳轉至 ScanPage]
    
    C -- "點擊清單項目" --> H[跳轉至詳情頁]
    
    C -- "點擊導覽列「審核管理」" --> I[顯示下拉選單]
    I --> J[跳轉至對應審核頁面]
```

---

## 2. 設備詳情頁 (Detail Page) 邏輯
**核心功能：** 意圖偵測、狀態機按鈕、表單整合。

```mermaid
flowchart TD
    M[頁面掛載] --> N[獲取 UUID]
    N --> O[獲取設備詳情 & 歷史紀錄]
    
    O --> P{檢查 URL 參數?}
    P -- "?intent=borrow/dispatch/move" --> Q[自動開啟對應 Modal]
    P -- "無參數" --> R[等待使用者操作]
    
    R --> S{設備目前狀態?}
    S -- "AVAILABLE" --> T[顯示: 借用、出庫、移動按鈕]
    S -- "TO_BE_MOVED" --> U[顯示: 修改計畫、開始搬運按鈕]
    S -- "IN_TRANSIT" --> V[顯示: 確認送達按鈕]
    S -- "BORROWED" --> W{是借用者?}
    W -- "Yes" --> X[顯示: 歸還按鈕]
    
    Q & T & U & V & X -- "觸發提交" --> Y[圖片壓縮處理]
    Y --> Z[發送 API 請求]
    Z -- "成功" --> AA[關閉 Modal & 刷新數據]
```

---

## 3. 掃描頁 (ScanPage) 邏輯
**核心功能：** 相機控制、內容識別、意圖路由。

```mermaid
flowchart TD
    S1[頁面掛載] --> S2[初始化掃描器實例]
    S2 --> S3{使用者操作?}
    
    S3 -- "點擊啟動相機" --> S4[請求相機權限]
    S4 -- "成功" --> S5[進入掃描迴圈]
    
    S5 -- "辨識成功" --> S6{內容類型?}
    S6 -- "location:UUID" --> S7[跳轉位置確認頁]
    S6 -- "設備 UUID" --> S8{檢查來源 Intent?}
    
    S8 -- "有 Intent" --> S9[跳轉至詳情頁 ?intent=xxx]
    S8 -- "無 Intent" --> S10[跳轉至普通詳情頁]
    
    S3 -- "上傳圖片" --> S11[靜態圖片識別]
    S11 --> S6
```

---

## 4. 管理審核頁 (Admin Requests) 邏輯
**核心功能：** 批量操作、審核追蹤。

```mermaid
flowchart TD
    Ad1[進入審核頁面] --> Ad2[獲取待審核清單]
    
    Ad2 --> Ad3{使用者操作?}
    
    Ad3 -- "勾選多個項目" --> Ad4[顯示底部批量工具列]
    Ad4 -- "點擊批量核准" --> Ad5[彈窗詢問統一備註]
    Ad5 -- "提交" --> Ad6[發送批量 API 請求]
    
    Ad3 -- "點擊單筆核准" --> Ad7[彈窗詢問個別備註]
    Ad7 -- "提交" --> Ad8[發送單筆 API 請求]
    
    Ad3 -- "點擊拒絕" --> Ad9[詢問拒絕原因]
    Ad9 --> Ad10[更新狀態為 REJECTED]
    
    Ad6 & Ad8 & Ad10 -- "成功" --> Ad11[清空選取 & 刷新列表]
```
